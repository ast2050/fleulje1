<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f5f5f0">
    <title>fleulje</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiZmxldWxqZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjVmNWYwIiwidGhlbWVfY29sb3IiOiIjZjVmNWYwIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJyUzRSUzQ3JlY3Qgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIGZpbGw9JyUyMzhmOWY4ZCcvJTNFJTNDdGV4dCB4PSc1MCUyNScgeT0nNTAlMjUnIGZvbnQtc2l6ZT0nMjUwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkeT0nLjM1ZW0nIGZpbGw9J3doaXRlJyBmb250LWZhbWlseT0nQXJpYWwsIHNhbnMtc2VyaWYnJTNFRiUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap');
        
        :root {
            --sage-green: #8f9f8d;
            --sage-green-light: #a8b5a6;
            --sage-green-dark: #7a8878;
            --sand-beige: #d4c5b0;
            --sand-beige-light: #e6dcc8;
            --off-white: #f5f5f0;
            --soft-gray: #b8b8b0;
            --alert-orange: #d4a574;
        }
        
        * {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f5f0 0%, #e8e8dc 100%);
        }
        
        .category-sachet { 
            background: linear-gradient(135deg, #c8d8c0 0%, #b5c9ad 100%);
            color: #4a5a48;
        }
        .category-candle { 
            background: linear-gradient(135deg, #e6dcc8 0%, #d4c5b0 100%);
            color: #6b5d4f;
        }
        .category-other { 
            background: linear-gradient(135deg, #d0d0c8 0%, #b8b8b0 100%);
            color: #5a5a52;
        }
        
        .low-stock {
            background: linear-gradient(135deg, #e8d5c4 0%, #d4c5b0 100%) !important;
            border: 2px solid var(--alert-orange) !important;
        }
        
        .out-of-stock {
            background: linear-gradient(135deg, #d0d0c8 0%, #c0c0b8 100%) !important;
            opacity: 0.5;
            cursor: not-allowed !important;
        }
        
        .cart-item {
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--sage-green) 0%, var(--sage-green-dark) 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(143, 159, 141, 0.2);
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 4px 12px rgba(143, 159, 141, 0.3);
            transform: translateY(-1px);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: white;
            border: 1.5px solid var(--sage-green-light);
            color: var(--sage-green-dark);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-secondary:hover {
            background: #f9f9f6;
            border-color: var(--sage-green);
        }
        
        .tab-active {
            border-bottom: 3px solid var(--sage-green);
            color: var(--sage-green-dark);
            font-weight: 500;
        }
        
        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .product-card:active:not(.out-of-stock) {
            transform: scale(0.97);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        
        .quantity-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            border: 1.5px solid var(--sage-green-light);
            color: var(--sage-green-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .quantity-btn:active {
            transform: scale(0.9);
            background: #f5f5f0;
        }
        
        .cart-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            padding: 18px;
            margin-bottom: 14px;
        }
        
        .selection-btn {
            border: 1.5px solid #e0e0d8;
            background: white;
            transition: all 0.2s;
            border-radius: 12px;
        }
        
        .selection-btn.selected {
            background: var(--sage-green);
            color: white;
            border-color: var(--sage-green);
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input, select, textarea {
            border: 1.5px solid #e0e0d8;
            border-radius: 12px;
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--sage-green);
            box-shadow: 0 0 0 3px rgba(143, 159, 141, 0.1);
        }
        
        #product-search {
            font-size: 16px;
            padding: 14px 20px;
            border: 2px solid var(--sage-green-light);
            background: white;
        }
        
        #product-search:focus {
            border-color: var(--sage-green);
            box-shadow: 0 0 0 4px rgba(143, 159, 141, 0.15);
        }
        
        #product-search::placeholder {
            color: var(--soft-gray);
            opacity: 0.7;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: #d0d0c8;
            border-radius: 13px;
            transition: 0.3s;
            cursor: pointer;
        }
        
        .toggle-switch.active {
            background: var(--sage-green);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }
        
        .toggle-switch.active::after {
            left: 24px;
        }
        
        .total-display {
            background: linear-gradient(135deg, var(--sage-green) 0%, var(--sage-green-dark) 100%);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(143, 159, 141, 0.25);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stock-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .stock-ok {
            background: #c8d8c0;
            color: #4a5a48;
        }
        
        .stock-low {
            background: #e8d5c4;
            color: #6b5d4f;
        }
        
        .stock-out {
            background: #d0d0c8;
            color: #5a5a52;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-2xl mx-auto min-h-screen bg-white shadow-2xl">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-50" style="background: linear-gradient(to bottom, #ffffff, #fafaf8);">
            <h1 class="text-center text-xl font-medium py-5 tracking-wide" style="color: var(--sage-green-dark);">fleulje</h1>
            <div class="flex border-t border-gray-200">
                <button onclick="switchTab('sales')" id="tab-sales" class="flex-1 py-4 text-xs font-medium tab-active">è²©å£²</button>
                <button onclick="switchTab('inventory')" id="tab-inventory" class="flex-1 py-4 text-xs font-medium text-gray-500">åœ¨åº«</button>
                <button onclick="switchTab('settings')" id="tab-settings" class="flex-1 py-4 text-xs font-medium text-gray-500">è¨­å®š</button>
                <button onclick="switchTab('history')" id="tab-history" class="flex-1 py-4 text-xs font-medium text-gray-500">å±¥æ­´</button>
            </div>
        </header>

        <!-- è²©å£²ã‚¿ãƒ– -->
        <div id="sales-tab" class="p-6">
            <div class="mb-6 p-4 rounded-xl" style="background: #f9f9f6;">
                <p class="text-xs text-center" style="color: var(--soft-gray);">ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã®åœ¨åº«ã‹ã‚‰è²©å£²ã—ã¾ã™</p>
            </div>
            
            <div class="mb-8">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">å•†å“é¸æŠ</h2>
                
                <!-- æ¤œç´¢ãƒãƒ¼ -->
                <div class="mb-4">
                    <input type="text" id="product-search" class="w-full text-base" placeholder="ğŸ” å•†å“åã§æ¤œç´¢..." oninput="filterProducts()" style="padding: 14px 20px; font-size: 16px;">
                </div>
                
                <div id="products-list" class="grid grid-cols-2 gap-3"></div>
            </div>

            <div class="rounded-2xl p-6 mb-8" style="background: linear-gradient(135deg, #f9f9f6 0%, #f0f0ea 100%);">
                <h2 class="text-sm font-semibold mb-5" style="color: var(--sage-green-dark);">ã‚«ãƒ¼ãƒˆ</h2>
                <div id="cart-items" class="mb-4"></div>
            </div>

            <div class="total-display">
                <div class="flex justify-between items-baseline mb-3">
                    <span class="text-white text-lg font-medium opacity-90">åˆè¨ˆé‡‘é¡</span>
                    <span id="total-amount" class="text-white text-4xl font-bold">Â¥0</span>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold mb-3" style="color: var(--sage-green-dark);">é ã‹ã‚Šé‡‘é¡</label>
                    <input type="number" id="payment-input" class="w-full px-6 py-5 text-2xl font-semibold" placeholder="0" style="color: var(--sage-green-dark);">
                </div>

                <div class="rounded-2xl p-6" style="background: linear-gradient(135deg, #f9f9f6 0%, #f0f0ea 100%);">
                    <div class="flex justify-between items-baseline">
                        <span class="text-base font-medium" style="color: var(--soft-gray);">ãŠã¤ã‚Š</span>
                        <span id="change-amount" class="text-3xl font-bold" style="color: var(--sage-green-dark);">Â¥0</span>
                    </div>
                </div>

                <div class="flex gap-3 pt-4">
                    <button onclick="clearCart()" class="flex-1 py-4 btn-secondary rounded-xl font-semibold text-base">ã‚¯ãƒªã‚¢</button>
                    <button onclick="initiateCheckout()" class="flex-1 py-5 btn-primary rounded-xl font-semibold text-base text-white">ä¼šè¨ˆå®Œäº†</button>
                </div>
            </div>
        </div>

        <!-- åœ¨åº«ç®¡ç†ã‚¿ãƒ– -->
        <div id="inventory-tab" class="p-6 hidden">
            <!-- ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†ãƒœã‚¿ãƒ³ -->
            <div class="mb-6 p-5 rounded-2xl" style="background: linear-gradient(135deg, #e6dcc8 0%, #d4c5b0 100%);">
                <h2 class="text-sm font-semibold mb-3" style="color: #6b5d4f;">ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†</h2>
                <button onclick="endEvent()" class="w-full py-4 rounded-xl font-semibold text-white" style="background: linear-gradient(135deg, var(--sage-green) 0%, var(--sage-green-dark) 100%); box-shadow: 0 2px 8px rgba(143, 159, 141, 0.2);">ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†ï¼ˆåœ¨åº«ã‚’è‡ªå®…ã¸æˆ»ã™ï¼‰</button>
            </div>
            
            <div class="mb-6">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">åˆ¶ä½œãƒ»å…¥åº«</h2>
                <div class="space-y-3">
                    <select id="production-product" class="w-full px-4 py-3">
                        <option value="">å•†å“ã‚’é¸æŠ</option>
                    </select>
                    <input type="number" id="production-quantity" class="w-full px-4 py-3" placeholder="å€‹æ•°" min="1">
                    <button onclick="addProduction()" class="w-full py-3 btn-primary rounded-xl font-medium text-white">è‡ªå®…ã«å…¥åº«</button>
                </div>
            </div>

            <div class="mb-6">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">åœ¨åº«ç§»å‹•</h2>
                <div class="space-y-3">
                    <select id="move-product" class="w-full px-4 py-3">
                        <option value="">å•†å“ã‚’é¸æŠ</option>
                    </select>
                    <select id="move-from" class="w-full px-4 py-3">
                        <option value="">ç§»å‹•å…ƒã‚’é¸æŠ</option>
                    </select>
                    <select id="move-to" class="w-full px-4 py-3">
                        <option value="">ç§»å‹•å…ˆã‚’é¸æŠ</option>
                    </select>
                    <input type="number" id="move-quantity" class="w-full px-4 py-3" placeholder="å€‹æ•°" min="1">
                    <button onclick="moveInventory()" class="w-full py-3 btn-primary rounded-xl font-medium text-white">åœ¨åº«ã‚’ç§»å‹•</button>
                </div>
            </div>

            <div class="mb-6">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">å§”è¨—å£²ä¸Šå ±å‘Š</h2>
                <div class="space-y-3">
                    <select id="consignment-location" class="w-full px-4 py-3" onchange="loadConsignmentStock()">
                        <option value="">å§”è¨—å…ˆã‚’é¸æŠ</option>
                    </select>
                    <div id="consignment-stock-list"></div>
                </div>
            </div>

            <div>
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">åœ¨åº«ä¸€è¦§</h2>
                <div id="inventory-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- è¨­å®šã‚¿ãƒ– -->
        <div id="settings-tab" class="p-6 hidden">
            <div class="mb-8">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">å•†å“ç™»éŒ²</h2>
                <div class="space-y-4">
                    <input type="text" id="product-name" class="w-full px-5 py-3" placeholder="å•†å“å">
                    <input type="number" id="product-price" class="w-full px-5 py-3" placeholder="ä¾¡æ ¼">
                    <select id="product-category" class="w-full px-5 py-3">
                        <option value="sachet">ã‚µã‚·ã‚§</option>
                        <option value="candle">ã‚­ãƒ£ãƒ³ãƒ‰ãƒ«</option>
                        <option value="other">ãã®ä»–</option>
                    </select>
                    <input type="number" id="product-alert" class="w-full px-5 py-3" placeholder="åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆæ•°ï¼ˆä¾‹ï¼š5ï¼‰" min="0">
                    <input type="number" id="product-display-order" class="w-full px-5 py-3" placeholder="è¡¨ç¤ºé †ï¼ˆå°ã•ã„æ•°å­—ã»ã©ä¸Šã«è¡¨ç¤ºï¼‰" min="0">
                    <button onclick="addProduct()" class="w-full py-4 btn-primary rounded-xl font-medium text-white">å•†å“ã‚’è¿½åŠ </button>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">ç™»éŒ²å•†å“ä¸€è¦§</h2>
                <div id="settings-products-list" class="space-y-3"></div>
            </div>

            <div class="mb-8">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">å§”è¨—å…ˆç®¡ç†</h2>
                <div class="space-y-3 mb-4">
                    <input type="text" id="location-name" class="w-full px-5 py-3" placeholder="å§”è¨—å…ˆåï¼ˆä¾‹ï¼šã€‡ã€‡é›‘è²¨åº—ï¼‰">
                    <button onclick="addLocation()" class="w-full py-3 btn-primary rounded-xl font-medium text-white">å§”è¨—å…ˆã‚’è¿½åŠ </button>
                </div>
                <div id="locations-list" class="space-y-2"></div>
            </div>

            <div class="p-6 rounded-2xl" style="background: linear-gradient(135deg, #f9f9f6 0%, #f0f0ea 100%);">
                <h2 class="text-sm font-semibold mb-4" style="color: var(--sage-green-dark);">å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¾©å…ƒ</h2>
                
                <div class="mb-6">
                    <p class="text-xs mb-3" style="color: var(--soft-gray);">ãƒ‡ãƒã‚¤ã‚¹é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã§å¼•è¶Šã—ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                    <button onclick="exportBackupData()" class="w-full py-3 btn-primary rounded-xl font-medium text-white text-sm mb-3">ãŠå¼•è¶Šã—ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</button>
                    <div id="backup-data-display" style="display: none;">
                        <label class="block text-xs font-medium mb-2" style="color: var(--soft-gray);">ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„</label>
                        <textarea id="backup-data-text" rows="6" class="w-full px-4 py-3 text-xs font-mono" readonly style="background: #fafaf8;"></textarea>
                        <button onclick="copyBackupData()" class="w-full py-2 btn-secondary rounded-xl font-medium text-sm mt-2">ã‚³ãƒ”ãƒ¼</button>
                    </div>
                </div>

                <div>
                    <p class="text-xs mb-3" style="color: var(--soft-gray);">åˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰æŒã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦å¾©å…ƒã—ã¦ãã ã•ã„</p>
                    <textarea id="restore-data-input" rows="6" class="w-full px-4 py-3 text-xs font-mono mb-3" placeholder="ãŠå¼•è¶Šã—ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"></textarea>
                    <button onclick="importBackupData()" class="w-full py-3 btn-primary rounded-xl font-medium text-white text-sm">ãŠå¼•è¶Šã—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</button>
                    <p class="text-xs mt-3" style="color: #c87a7a;">â€» èª­ã¿è¾¼ã‚€ã¨ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>

        <!-- å±¥æ­´ã‚¿ãƒ– -->
        <div id="history-tab" class="p-6 hidden">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-sm font-semibold" style="color: var(--sage-green-dark);">å£²ä¸Šå±¥æ­´</h2>
                <div class="flex gap-2">
                    <button onclick="exportCSV()" class="px-4 py-2 rounded-xl text-sm font-medium text-white" style="background: linear-gradient(135deg, #6b9a6e 0%, #5a8a5d 100%);">CSVå‡ºåŠ›</button>
                    <button onclick="clearHistory()" class="px-4 py-2 rounded-xl text-sm font-medium text-white" style="background: linear-gradient(135deg, #c87a7a 0%, #b86a6a 100%);">å…¨å‰Šé™¤</button>
                </div>
            </div>
            <div id="history-list" class="space-y-3"></div>
        </div>
    </div>

    <!-- é¡§å®¢å±æ€§å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="customer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 class="text-xl font-semibold mb-6 text-center" style="color: var(--sage-green-dark);">é¡§å®¢æƒ…å ±ã®å…¥åŠ›</h2>
            
            <div class="mb-6">
                <label class="block text-sm font-semibold mb-3" style="color: var(--sage-green-dark);">æ€§åˆ¥</label>
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="selectModalGender('å¥³æ€§')" class="modal-gender-btn selection-btn py-3 px-4 text-sm font-medium">å¥³æ€§</button>
                    <button onclick="selectModalGender('ç”·æ€§')" class="modal-gender-btn selection-btn py-3 px-4 text-sm font-medium">ç”·æ€§</button>
                    <button onclick="selectModalGender('ãã®ä»–')" class="modal-gender-btn selection-btn py-3 px-4 text-sm font-medium">ãã®ä»–</button>
                </div>
            </div>

            <div class="mb-8">
                <label class="block text-sm font-semibold mb-3" style="color: var(--sage-green-dark);">å¹´é½¢å±¤</label>
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="selectModalAge('10ä»£ä»¥ä¸‹')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">10ä»£ä»¥ä¸‹</button>
                    <button onclick="selectModalAge('20ä»£')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">20ä»£</button>
                    <button onclick="selectModalAge('30ä»£')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">30ä»£</button>
                    <button onclick="selectModalAge('40ä»£')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">40ä»£</button>
                    <button onclick="selectModalAge('50ä»£')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">50ä»£</button>
                    <button onclick="selectModalAge('60ä»£ä»¥ä¸Š')" class="modal-age-btn selection-btn py-3 px-4 text-sm font-medium">60ä»£ä»¥ä¸Š</button>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 py-4 btn-secondary rounded-xl font-semibold">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="saveCustomerData()" class="flex-1 py-4 btn-primary rounded-xl font-semibold text-white">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let locations = JSON.parse(localStorage.getItem('locations')) || [];
        let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
        let cart = [];
        let tempSaleData = null;
        let modalGender = '';
        let modalAge = '';

        // åˆæœŸåŒ–
        function init() {
            // å•†å“ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«åœ¨åº«æƒ…å ±ã¨è¡¨ç¤ºé †ã‚’è¿½åŠ ï¼‰
            products = products.map(p => {
                if (!p.inventory) {
                    p.inventory = { base: 0, event: 0, consignments: {} };
                }
                if (p.alertStock === undefined) {
                    p.alertStock = 5;
                }
                if (p.displayOrder === undefined) {
                    p.displayOrder = 999;
                }
                return p;
            });
            localStorage.setItem('products', JSON.stringify(products));

            renderProducts();
            renderSettingsProducts();
            renderHistory();
            renderInventoryList();
            renderLocationsList();
            updateCartDisplay();
            updateInventorySelectors();
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tab) {
            document.querySelectorAll('[id$="-tab"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.classList.remove('tab-active');
                el.classList.add('text-gray-500');
            });
            
            document.getElementById(`${tab}-tab`).classList.remove('hidden');
            const activeTab = document.getElementById(`tab-${tab}`);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('text-gray-500');
            
            if (tab === 'inventory') {
                updateInventorySelectors();
                renderInventoryList();
            }
        }

        // å•†å“è¿½åŠ 
        function addProduct() {
            const name = document.getElementById('product-name').value.trim();
            const price = parseInt(document.getElementById('product-price').value);
            const category = document.getElementById('product-category').value;
            const alertStock = parseInt(document.getElementById('product-alert').value) || 5;
            const displayOrder = parseInt(document.getElementById('product-display-order').value) || 999;

            if (!name || !price) {
                alert('å•†å“åã¨ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            products.push({
                id: Date.now(),
                name,
                price,
                category,
                active: true,
                alertStock,
                displayOrder,
                inventory: { base: 0, event: 0, consignments: {} }
            });

            localStorage.setItem('products', JSON.stringify(products));
            document.getElementById('product-name').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-alert').value = '';
            document.getElementById('product-display-order').value = '';
            
            renderProducts();
            renderSettingsProducts();
            renderInventoryList();
            updateInventorySelectors();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåœ¨åº«ã‚’è‡ªå®…ã¸æˆ»ã™ï¼‰
        function endEvent() {
            // ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã«åœ¨åº«ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const hasEventStock = products.some(p => p.inventory.event > 0);
            
            if (!hasEventStock) {
                alert('ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã«åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (!confirm('ã‚¤ãƒ™ãƒ³ãƒˆã‚’çµ‚äº†ã—ã€æ®‹ã‚Šã®åœ¨åº«ã‚’ã™ã¹ã¦è‡ªå®…ã¸æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            // ã™ã¹ã¦ã®å•†å“ã®ã‚¤ãƒ™ãƒ³ãƒˆåœ¨åº«ã‚’è‡ªå®…ã¸ç§»å‹•
            products.forEach(p => {
                if (p.inventory.event > 0) {
                    p.inventory.base += p.inventory.event;
                    p.inventory.event = 0;
                }
            });
            
            localStorage.setItem('products', JSON.stringify(products));
            renderInventoryList();
            renderProducts();
            
            alert('ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã®åœ¨åº«ã‚’è‡ªå®…ã¸æˆ»ã—ã¾ã—ãŸ');
        }

        // å§”è¨—å…ˆè¿½åŠ 
        function addLocation() {
            const name = document.getElementById('location-name').value.trim();
            
            if (!name) {
                alert('å§”è¨—å…ˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            locations.push({
                id: Date.now(),
                name,
                type: 'consignment'
            });

            localStorage.setItem('locations', JSON.stringify(locations));
            document.getElementById('location-name').value = '';
            
            renderLocationsList();
            updateInventorySelectors();
        }

        // å§”è¨—å…ˆå‰Šé™¤
        function deleteLocation(id) {
            if (!confirm('ã“ã®å§”è¨—å…ˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€» åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™')) return;
            
            // å§”è¨—å…ˆã®åœ¨åº«ã‚’å‰Šé™¤
            products.forEach(p => {
                if (p.inventory.consignments[id]) {
                    delete p.inventory.consignments[id];
                }
            });
            
            locations = locations.filter(l => l.id !== id);
            localStorage.setItem('locations', JSON.stringify(locations));
            localStorage.setItem('products', JSON.stringify(products));
            
            renderLocationsList();
            renderInventoryList();
            updateInventorySelectors();
        }

        // å§”è¨—å…ˆãƒªã‚¹ãƒˆè¡¨ç¤º
        function renderLocationsList() {
            const container = document.getElementById('locations-list');
            
            if (locations.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-sm" style="color: var(--soft-gray);">å§”è¨—å…ˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = locations.map(loc => `
                <div class="flex items-center justify-between p-3 bg-white rounded-xl border" style="border-color: #e0e0d8;">
                    <span class="text-sm font-medium" style="color: var(--sage-green-dark);">${loc.name}</span>
                    <button onclick="deleteLocation(${loc.id})" class="text-xs font-medium px-3 py-1 rounded-lg" style="color: #c87a7a; border: 1px solid #e8d5d5;">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        // åœ¨åº«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æ›´æ–°
        function updateInventorySelectors() {
            // åˆ¶ä½œãƒ»å…¥åº«ã®å•†å“é¸æŠ
            const prodSelect = document.getElementById('production-product');
            prodSelect.innerHTML = '<option value="">å•†å“ã‚’é¸æŠ</option>' + 
                products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            
            // åœ¨åº«ç§»å‹•ã®å•†å“é¸æŠ
            const moveSelect = document.getElementById('move-product');
            moveSelect.innerHTML = '<option value="">å•†å“ã‚’é¸æŠ</option>' + 
                products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            
            // ç§»å‹•å…ƒé¸æŠï¼ˆå§”è¨—å…ˆã‚’å«ã‚€ï¼‰
            const moveFromSelect = document.getElementById('move-from');
            moveFromSelect.innerHTML = '<option value="">ç§»å‹•å…ƒã‚’é¸æŠ</option>' +
                '<option value="base">è‡ªå®…</option>' +
                '<option value="event">ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´</option>' +
                locations.map(l => `<option value="consignment:${l.id}">${l.name}</option>`).join('');
            
            // ç§»å‹•å…ˆé¸æŠ
            const moveToSelect = document.getElementById('move-to');
            moveToSelect.innerHTML = '<option value="">ç§»å‹•å…ˆã‚’é¸æŠ</option>' +
                '<option value="base">è‡ªå®…</option>' +
                '<option value="event">ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´</option>' +
                locations.map(l => `<option value="consignment:${l.id}">${l.name}</option>`).join('');
            
            // å§”è¨—å…ˆé¸æŠ
            const consSelect = document.getElementById('consignment-location');
            consSelect.innerHTML = '<option value="">å§”è¨—å…ˆã‚’é¸æŠ</option>' +
                locations.map(l => `<option value="${l.id}">${l.name}</option>`).join('');
        }

        // åˆ¶ä½œãƒ»å…¥åº«
        function addProduction() {
            const productId = parseInt(document.getElementById('production-product').value);
            const quantity = parseInt(document.getElementById('production-quantity').value);
            
            if (!productId || !quantity || quantity < 1) {
                alert('å•†å“ã¨å€‹æ•°ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            product.inventory.base += quantity;
            
            localStorage.setItem('products', JSON.stringify(products));
            document.getElementById('production-quantity').value = '';
            
            renderInventoryList();
            alert(`${product.name} ã‚’ ${quantity}å€‹ è‡ªå®…ã«å…¥åº«ã—ã¾ã—ãŸ`);
        }

        // åœ¨åº«ç§»å‹•
        function moveInventory() {
            const productId = parseInt(document.getElementById('move-product').value);
            const fromLoc = document.getElementById('move-from').value;
            const toLoc = document.getElementById('move-to').value;
            const quantity = parseInt(document.getElementById('move-quantity').value);
            
            if (!productId || !fromLoc || !toLoc || !quantity || quantity < 1) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (fromLoc === toLoc) {
                alert('åŒã˜å ´æ‰€ã¸ã®ç§»å‹•ã¯ã§ãã¾ã›ã‚“');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            
            // ç§»å‹•å…ƒã®åœ¨åº«ç¢ºèª
            let fromStock = 0;
            if (fromLoc === 'base' || fromLoc === 'event') {
                fromStock = product.inventory[fromLoc];
            } else if (fromLoc.startsWith('consignment:')) {
                const consId = fromLoc.split(':')[1];
                fromStock = product.inventory.consignments[consId] || 0;
            }
            
            if (fromStock < quantity) {
                alert('ç§»å‹•å…ƒã®åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
                return;
            }
            
            // åœ¨åº«ç§»å‹•å‡¦ç†
            if (fromLoc === 'base' || fromLoc === 'event') {
                product.inventory[fromLoc] -= quantity;
            } else if (fromLoc.startsWith('consignment:')) {
                const consId = fromLoc.split(':')[1];
                product.inventory.consignments[consId] -= quantity;
            }
            
            if (toLoc === 'base' || toLoc === 'event') {
                product.inventory[toLoc] += quantity;
            } else if (toLoc.startsWith('consignment:')) {
                const consId = toLoc.split(':')[1];
                if (!product.inventory.consignments[consId]) {
                    product.inventory.consignments[consId] = 0;
                }
                product.inventory.consignments[consId] += quantity;
            }
            
            localStorage.setItem('products', JSON.stringify(products));
            document.getElementById('move-quantity').value = '';
            
            renderInventoryList();
            renderProducts();
            alert('åœ¨åº«ã‚’ç§»å‹•ã—ã¾ã—ãŸ');
        }

        // å§”è¨—åœ¨åº«è¡¨ç¤º
        function loadConsignmentStock() {
            const locId = document.getElementById('consignment-location').value;
            const container = document.getElementById('consignment-stock-list');
            
            if (!locId) {
                container.innerHTML = '';
                return;
            }
            
            const location = locations.find(l => l.id == locId);
            const stockProducts = products.filter(p => (p.inventory.consignments[locId] || 0) > 0);
            
            if (stockProducts.length === 0) {
                container.innerHTML = '<div class="text-sm py-4" style="color: var(--soft-gray);">åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = `
                <div class="mt-4 space-y-3">
                    ${stockProducts.map(p => `
                        <div class="p-3 bg-white rounded-xl border" style="border-color: #e0e0d8;">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium" style="color: var(--sage-green-dark);">${p.name}</span>
                                <span class="text-xs" style="color: var(--soft-gray);">åœ¨åº«: ${p.inventory.consignments[locId]}å€‹</span>
                            </div>
                            <div class="flex gap-2">
                                <input type="number" id="consign-sold-${p.id}" class="flex-1 px-3 py-2 text-sm" placeholder="å£²ã‚ŒãŸæ•°" min="0" max="${p.inventory.consignments[locId]}">
                                <button onclick="recordConsignmentSale(${p.id}, ${locId})" class="px-4 py-2 btn-primary rounded-lg text-sm text-white">ç¢ºå®š</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // å§”è¨—å£²ä¸Šç¢ºå®š
        function recordConsignmentSale(productId, locId) {
            const soldQty = parseInt(document.getElementById(`consign-sold-${productId}`).value);
            
            if (!soldQty || soldQty < 1) {
                alert('å£²ã‚ŒãŸæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            const currentStock = product.inventory.consignments[locId] || 0;
            
            if (soldQty > currentStock) {
                alert('åœ¨åº«æ•°ã‚’è¶…ãˆã¦ã„ã¾ã™');
                return;
            }
            
            const location = locations.find(l => l.id == locId);
            
            // åœ¨åº«ã‚’æ¸›ã‚‰ã™
            product.inventory.consignments[locId] -= soldQty;
            
            // å£²ä¸Šå±¥æ­´ã«è¨˜éŒ²
            const saleData = {
                timestamp: new Date().toISOString(),
                items: [{
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: soldQty
                }],
                gender: 'å§”è¨—',
                age: '-',
                total: product.price * soldQty,
                location: `consignment:${locId}`,
                locationName: location.name
            };
            
            salesHistory.push(saleData);
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            localStorage.setItem('products', JSON.stringify(products));
            
            document.getElementById(`consign-sold-${productId}`).value = '';
            loadConsignmentStock();
            renderInventoryList();
            renderHistory();
            
            alert(`${location.name}ã§ã®å£²ä¸Šã‚’è¨˜éŒ²ã—ã¾ã—ãŸ`);
        }

        // åœ¨åº«ä¸€è¦§è¡¨ç¤ºï¼ˆå ´æ‰€ã”ã¨ï¼‰
        function renderInventoryList() {
            const container = document.getElementById('inventory-list');
            
            if (products.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-sm" style="color: var(--soft-gray);">å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            let html = '';
            
            // è‡ªå®…ã®åœ¨åº«
            const baseProducts = products.filter(p => p.inventory.base > 0);
            html += `
                <div class="mb-6">
                    <h3 class="text-sm font-semibold mb-3 px-2" style="color: var(--sage-green-dark);">ğŸ  è‡ªå®…</h3>
                    ${baseProducts.length === 0 ? 
                        '<div class="text-xs px-2" style="color: var(--soft-gray);">åœ¨åº«ãªã—</div>' :
                        baseProducts.map(p => `
                            <div class="p-3 mb-2 bg-white rounded-xl border" style="border-color: #e0e0d8;">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium" style="color: var(--sage-green-dark);">${p.name}</span>
                                    <div class="flex items-center gap-2">
                                        <button onclick="adjustInventory(${p.id}, 'base', -1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">âˆ’</button>
                                        <span class="text-sm font-bold w-12 text-center" style="color: var(--sage-green-dark);">${p.inventory.base}å€‹</span>
                                        <button onclick="adjustInventory(${p.id}, 'base', 1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">+</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
            `;
            
            // ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã®åœ¨åº«
            const eventProducts = products.filter(p => p.inventory.event > 0);
            html += `
                <div class="mb-6">
                    <h3 class="text-sm font-semibold mb-3 px-2" style="color: var(--sage-green-dark);">ğŸª ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´</h3>
                    ${eventProducts.length === 0 ? 
                        '<div class="text-xs px-2" style="color: var(--soft-gray);">åœ¨åº«ãªã—</div>' :
                        eventProducts.map(p => {
                            const isLow = p.inventory.event <= p.alertStock;
                            return `
                                <div class="p-3 mb-2 bg-white rounded-xl border ${isLow ? 'border-2' : ''}" style="border-color: ${isLow ? 'var(--alert-orange)' : '#e0e0d8'};">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="text-sm font-medium" style="color: var(--sage-green-dark);">${p.name}</span>
                                            ${isLow ? '<span class="ml-2 stock-badge stock-low">æ®‹ã‚Šã‚ãšã‹</span>' : ''}
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button onclick="adjustInventory(${p.id}, 'event', -1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">âˆ’</button>
                                            <span class="text-sm font-bold w-12 text-center" style="color: var(--sage-green-dark);">${p.inventory.event}å€‹</span>
                                            <button onclick="adjustInventory(${p.id}, 'event', 1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">+</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')
                    }
                </div>
            `;
            
            // å§”è¨—å…ˆã”ã¨ã®åœ¨åº«
            locations.forEach(loc => {
                const consignProducts = products.filter(p => (p.inventory.consignments[loc.id] || 0) > 0);
                html += `
                    <div class="mb-6">
                        <h3 class="text-sm font-semibold mb-3 px-2" style="color: var(--sage-green-dark);">ğŸª ${loc.name}</h3>
                        ${consignProducts.length === 0 ? 
                            '<div class="text-xs px-2" style="color: var(--soft-gray);">åœ¨åº«ãªã—</div>' :
                            consignProducts.map(p => `
                                <div class="p-3 mb-2 bg-white rounded-xl border" style="border-color: #e0e0d8;">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium" style="color: var(--sage-green-dark);">${p.name}</span>
                                        <div class="flex items-center gap-2">
                                            <button onclick="adjustInventory(${p.id}, 'consignment:${loc.id}', -1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">âˆ’</button>
                                            <span class="text-sm font-bold w-12 text-center" style="color: var(--sage-green-dark);">${p.inventory.consignments[loc.id]}å€‹</span>
                                            <button onclick="adjustInventory(${p.id}, 'consignment:${loc.id}', 1)" class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold" style="background: white; border: 1.5px solid var(--sage-green-light); color: var(--sage-green-dark);">+</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                `;
            });
            
            // å§”è¨—å…ˆãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (locations.length === 0) {
                html += `
                    <div class="p-4 rounded-xl text-center" style="background: #f9f9f6;">
                        <p class="text-xs" style="color: var(--soft-gray);">å§”è¨—å…ˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã“ã“ã«åœ¨åº«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // åœ¨åº«æ•°ã‚’èª¿æ•´
        function adjustInventory(productId, location, amount) {
            const product = products.find(p => p.id === productId);
            
            if (location === 'base' || location === 'event') {
                const newAmount = product.inventory[location] + amount;
                if (newAmount < 0) {
                    alert('åœ¨åº«æ•°ã¯0æœªæº€ã«ã§ãã¾ã›ã‚“');
                    return;
                }
                product.inventory[location] = newAmount;
            } else if (location.startsWith('consignment:')) {
                const locId = location.split(':')[1];
                const currentAmount = product.inventory.consignments[locId] || 0;
                const newAmount = currentAmount + amount;
                if (newAmount < 0) {
                    alert('åœ¨åº«æ•°ã¯0æœªæº€ã«ã§ãã¾ã›ã‚“');
                    return;
                }
                if (newAmount === 0) {
                    delete product.inventory.consignments[locId];
                } else {
                    product.inventory.consignments[locId] = newAmount;
                }
            }
            
            localStorage.setItem('products', JSON.stringify(products));
            renderInventoryList();
            renderProducts();
        }

        // å•†å“è¡¨ç¤ºï¼ˆè²©å£²ç”»é¢ï¼‰
        function renderProducts(searchQuery = '') {
            const container = document.getElementById('products-list');
            let activeProducts = products.filter(p => p.active);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆåœ¨åº«ãŒã‚ã‚‹å•†å“ã®ã¿è¡¨ç¤º
            activeProducts = activeProducts.filter(p => p.inventory.event > 0);
            
            // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            if (searchQuery) {
                activeProducts = activeProducts.filter(p => 
                    p.name.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }
            
            // è¡¨ç¤ºé †ã§ã‚½ãƒ¼ãƒˆï¼ˆdisplayOrderæ˜‡é †ã€åŒã˜ãªã‚‰idæ˜‡é †ï¼‰
            activeProducts.sort((a, b) => {
                if (a.displayOrder !== b.displayOrder) {
                    return a.displayOrder - b.displayOrder;
                }
                return a.id - b.id;
            });
            
            if (activeProducts.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-400">è²©å£²å¯èƒ½ãªå•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = activeProducts.map(product => {
                const eventStock = product.inventory.event;
                const isLowStock = eventStock <= product.alertStock;
                
                let classes = `category-${product.category} product-card p-5 rounded-2xl`;
                if (isLowStock) classes += ' low-stock';
                
                return `
                    <button onclick="addToCart(${product.id})" class="${classes}">
                        <div class="font-medium text-base">${product.name}</div>
                        <div class="text-sm mt-2 font-semibold">Â¥${product.price.toLocaleString()}</div>
                        <div class="text-xs mt-2 font-medium">æ®‹ã‚Š${eventStock}å€‹</div>
                    </button>
                `;
            }).join('');
        }

        // å•†å“æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterProducts() {
            const searchQuery = document.getElementById('product-search').value;
            renderProducts(searchQuery);
        }

        // è¨­å®šç”»é¢ã®å•†å“ä¸€è¦§
        function renderSettingsProducts() {
            const container = document.getElementById('settings-products-list');
            
            if (products.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // è¡¨ç¤ºé †ã§ã‚½ãƒ¼ãƒˆ
            const sortedProducts = [...products].sort((a, b) => {
                if (a.displayOrder !== b.displayOrder) {
                    return a.displayOrder - b.displayOrder;
                }
                return a.id - b.id;
            });
            
            container.innerHTML = sortedProducts.map(product => `
                <div class="p-4 bg-white rounded-2xl border" style="border-color: #e0e0d8;">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="font-semibold text-base mb-2" style="color: var(--sage-green-dark);">${product.name}</div>
                            <div id="product-view-${product.id}" class="text-sm space-y-1" style="color: var(--soft-gray);">
                                <div>ä¾¡æ ¼: Â¥${product.price.toLocaleString()}</div>
                                <div>ã‚¢ãƒ©ãƒ¼ãƒˆ: ${product.alertStock}å€‹</div>
                                <div>è¡¨ç¤ºé †: ${product.displayOrder}</div>
                            </div>
                            <div id="product-edit-${product.id}" class="space-y-2" style="display: none;">
                                <div class="flex items-center gap-2">
                                    <label class="text-xs w-20" style="color: var(--soft-gray);">ä¾¡æ ¼:</label>
                                    <input type="number" id="edit-price-${product.id}" value="${product.price}" class="flex-1 px-3 py-2 text-sm" min="0">
                                </div>
                                <div class="flex items-center gap-2">
                                    <label class="text-xs w-20" style="color: var(--soft-gray);">ã‚¢ãƒ©ãƒ¼ãƒˆ:</label>
                                    <input type="number" id="edit-alert-${product.id}" value="${product.alertStock}" class="flex-1 px-3 py-2 text-sm" min="0">
                                </div>
                                <div class="flex items-center gap-2">
                                    <label class="text-xs w-20" style="color: var(--soft-gray);">è¡¨ç¤ºé †:</label>
                                    <input type="number" id="edit-order-${product.id}" value="${product.displayOrder}" class="flex-1 px-3 py-2 text-sm" min="0">
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <button onclick="saveProductEdit(${product.id})" class="flex-1 py-2 btn-primary rounded-lg text-sm text-white">ä¿å­˜</button>
                                    <button onclick="cancelProductEdit(${product.id})" class="flex-1 py-2 btn-secondary rounded-lg text-sm">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-2 ml-3">
                            <div class="toggle-switch ${product.active ? 'active' : ''}" onclick="toggleProduct(${product.id})"></div>
                            <button id="edit-btn-${product.id}" onclick="startProductEdit(${product.id})" class="text-xs font-medium px-3 py-1 rounded-lg" style="color: var(--sage-green-dark); border: 1px solid var(--sage-green-light);">ç·¨é›†</button>
                            <button onclick="deleteProduct(${product.id})" class="text-xs font-medium px-3 py-1 rounded-lg" style="color: #c87a7a; border: 1px solid #e8d5d5;">å‰Šé™¤</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // å•†å“ç·¨é›†é–‹å§‹
        function startProductEdit(productId) {
            document.getElementById(`product-view-${productId}`).style.display = 'none';
            document.getElementById(`product-edit-${productId}`).style.display = 'block';
            document.getElementById(`edit-btn-${productId}`).style.display = 'none';
        }

        // å•†å“ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        function cancelProductEdit(productId) {
            document.getElementById(`product-view-${productId}`).style.display = 'block';
            document.getElementById(`product-edit-${productId}`).style.display = 'none';
            document.getElementById(`edit-btn-${productId}`).style.display = 'block';
        }

        // å•†å“ç·¨é›†ä¿å­˜
        function saveProductEdit(productId) {
            const product = products.find(p => p.id === productId);
            
            const newPrice = parseInt(document.getElementById(`edit-price-${productId}`).value);
            const newAlert = parseInt(document.getElementById(`edit-alert-${productId}`).value);
            const newOrder = parseInt(document.getElementById(`edit-order-${productId}`).value);
            
            if (!newPrice || newPrice < 0) {
                alert('æ­£ã—ã„ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (newAlert === undefined || newAlert < 0) {
                alert('æ­£ã—ã„ã‚¢ãƒ©ãƒ¼ãƒˆæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (newOrder === undefined || newOrder < 0) {
                alert('æ­£ã—ã„è¡¨ç¤ºé †ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            product.price = newPrice;
            product.alertStock = newAlert;
            product.displayOrder = newOrder;
            
            localStorage.setItem('products', JSON.stringify(products));
            
            // ç”»é¢ã‚’æ›´æ–°
            renderSettingsProducts();
            renderProducts();
            renderInventoryList();
            
            alert('å•†å“æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        }

        // å•†å“ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
        function toggleProduct(id) {
            const product = products.find(p => p.id === id);
            product.active = !product.active;
            localStorage.setItem('products', JSON.stringify(products));
            renderProducts();
            renderSettingsProducts();
        }

        // å•†å“å‰Šé™¤
        function deleteProduct(id) {
            if (!confirm('ã“ã®å•†å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€» åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™')) return;
            products = products.filter(p => p.id !== id);
            localStorage.setItem('products', JSON.stringify(products));
            renderProducts();
            renderSettingsProducts();
            renderInventoryList();
        }

        // ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆåœ¨åº«ãƒã‚§ãƒƒã‚¯
            if (product.inventory.event === 0) {
                alert('åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const cartItem = cart.find(item => item.productId === productId);
            const cartQty = cartItem ? cartItem.quantity : 0;
            
            if (cartQty >= product.inventory.event) {
                alert('ã“ã‚Œä»¥ä¸Šã‚«ãƒ¼ãƒˆã«è¿½åŠ ã§ãã¾ã›ã‚“ï¼ˆåœ¨åº«ä¸è¶³ï¼‰');
                return;
            }

            if (cartItem) {
                cartItem.quantity++;
            } else {
                cart.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }

            updateCartDisplay();
        }

        // ã‚«ãƒ¼ãƒˆè¡¨ç¤ºæ›´æ–°
        function updateCartDisplay() {
            const container = document.getElementById('cart-items');
            
            if (cart.length === 0) {
                container.innerHTML = '<div class="text-center py-6" style="color: var(--soft-gray);">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</div>';
            } else {
                container.innerHTML = cart.map((item, index) => {
                    const product = products.find(p => p.id === item.productId);
                    const maxQty = product ? product.inventory.event : 0;
                    
                    return `
                    <div class="cart-item cart-card">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <div class="font-semibold text-base" style="color: var(--sage-green-dark);">${item.name}</div>
                                <div class="flex items-center gap-2 mt-2">
                                    <input type="number" value="${item.price}" onchange="updateItemPrice(${index}, this.value)" class="w-28 px-3 py-2 text-sm font-semibold" style="color: var(--sage-green-dark);">
                                </div>
                            </div>
                            <div class="text-xl font-bold" style="color: var(--sage-green-dark);">Â¥${(item.price * item.quantity).toLocaleString()}</div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <button onclick="decreaseQuantity(${index})" class="quantity-btn">âˆ’</button>
                                <span class="font-bold text-xl w-10 text-center" style="color: var(--sage-green-dark);">${item.quantity}</span>
                                <button onclick="increaseQuantity(${index})" class="quantity-btn" ${item.quantity >= maxQty ? 'disabled style="opacity:0.3"' : ''}>+</button>
                            </div>
                            <button onclick="removeFromCart(${index})" class="text-sm font-medium" style="color: #c87a7a;">å‰Šé™¤</button>
                        </div>
                    </div>
                `}).join('');
            }

            updateTotal();
        }

        // å€‹æ•°å¢—åŠ 
        function increaseQuantity(index) {
            const item = cart[index];
            const product = products.find(p => p.id === item.productId);
            
            if (item.quantity >= product.inventory.event) {
                alert('åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
                return;
            }
            
            item.quantity++;
            updateCartDisplay();
        }

        // å€‹æ•°æ¸›å°‘
        function decreaseQuantity(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
                updateCartDisplay();
            } else {
                removeFromCart(index);
            }
        }

        // å•†å“å˜ä¾¡å¤‰æ›´
        function updateItemPrice(index, newPrice) {
            cart[index].price = parseInt(newPrice) || 0;
            updateCartDisplay();
        }

        // ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        // åˆè¨ˆé‡‘é¡æ›´æ–°
        function updateTotal() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('total-amount').textContent = `Â¥${total.toLocaleString()}`;
            updateChange();
        }

        // ãŠã¤ã‚Šè¨ˆç®—
        function updateChange() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const payment = parseInt(document.getElementById('payment-input').value) || 0;
            const change = payment - total;
            document.getElementById('change-amount').textContent = `Â¥${Math.max(0, change).toLocaleString()}`;
        }

        document.getElementById('payment-input').addEventListener('input', updateChange);

        // ä¼šè¨ˆé–‹å§‹ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼‰
        function initiateCheckout() {
            if (cart.length === 0) {
                alert('ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™');
                return;
            }

            tempSaleData = {
                timestamp: new Date().toISOString(),
                items: cart.map(item => ({...item})),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                location: 'event'
            };

            showModal();
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showModal() {
            modalGender = '';
            modalAge = '';
            document.querySelectorAll('.modal-gender-btn, .modal-age-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('customer-modal').style.display = 'flex';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('customer-modal').style.display = 'none';
            tempSaleData = null;
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§æ€§åˆ¥é¸æŠ
        function selectModalGender(gender) {
            modalGender = gender;
            document.querySelectorAll('.modal-gender-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§å¹´é½¢å±¤é¸æŠ
        function selectModalAge(age) {
            modalAge = age;
            document.querySelectorAll('.modal-age-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // é¡§å®¢ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆä¼šè¨ˆå®Œäº†ï¼‰
        async function saveCustomerData() {
            if (!modalGender || !modalAge) {
                alert('æ€§åˆ¥ã¨å¹´é½¢å±¤ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const saveBtn = event.target;
            const cancelBtn = saveBtn.previousElementSibling;
            const originalText = saveBtn.textContent;
            
            saveBtn.disabled = true;
            cancelBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';
            saveBtn.style.opacity = '0.6';

            tempSaleData.gender = modalGender;
            tempSaleData.age = modalAge;

            // ã‚¤ãƒ™ãƒ³ãƒˆåœ¨åº«ã‚’æ¸›ã‚‰ã™
            tempSaleData.items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.inventory.event -= item.quantity;
                }
            });

            salesHistory.push(tempSaleData);
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            localStorage.setItem('products', JSON.stringify(products));

            saveBtn.disabled = false;
            cancelBtn.disabled = false;
            saveBtn.textContent = originalText;
            saveBtn.style.opacity = '1';

            closeModal();

            alert('ä¼šè¨ˆãŒå®Œäº†ã—ã¾ã—ãŸ');
            clearCart();
            renderHistory();
            renderProducts();
            renderInventoryList();
        }

        // ã‚«ãƒ¼ãƒˆã‚¯ãƒªã‚¢
        function clearCart() {
            cart = [];
            document.getElementById('payment-input').value = '';
            updateCartDisplay();
        }

        // å±¥æ­´è¡¨ç¤º
        function renderHistory() {
            const container = document.getElementById('history-list');
            
            if (salesHistory.length === 0) {
                container.innerHTML = '<div class="text-center py-10" style="color: var(--soft-gray);">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            container.innerHTML = salesHistory.slice().reverse().map((sale, reverseIndex) => {
                const actualIndex = salesHistory.length - 1 - reverseIndex;
                
                let locationName = 'ã‚¤ãƒ™ãƒ³ãƒˆ';
                if (sale.location && sale.location.startsWith('consignment:')) {
                    locationName = sale.locationName || 'å§”è¨—å…ˆ';
                }
                
                return `
                <div class="p-5 rounded-2xl border relative" style="background: white; border-color: #e0e0d8;">
                    <button onclick="deleteHistoryItem(${actualIndex})" class="absolute top-4 right-4 text-xs font-medium px-2 py-1 rounded-lg transition-all" style="color: #c87a7a; background: transparent; border: 1px solid #e8d5d5;" onmouseover="this.style.background='#fef5f5'" onmouseout="this.style.background='transparent'">å‰Šé™¤</button>
                    <div class="flex justify-between items-start mb-3 pr-12">
                        <div class="text-xs" style="color: var(--soft-gray);">${new Date(sale.timestamp).toLocaleString('ja-JP')}</div>
                        <div class="text-base font-bold" style="color: var(--sage-green-dark);">Â¥${sale.total.toLocaleString()}</div>
                    </div>
                    <div class="text-xs mb-3" style="color: var(--soft-gray);">${sale.gender} / ${sale.age} / ${locationName}</div>
                    <div class="space-y-1">
                        ${sale.items.map(item => `
                            <div class="text-sm" style="color: var(--sage-green-dark);">${item.name} (Â¥${item.price.toLocaleString()}) Ã— ${item.quantity}</div>
                        `).join('')}
                    </div>
                </div>
            `}).join('');
        }

        // å±¥æ­´ã®å€‹åˆ¥å‰Šé™¤
        function deleteHistoryItem(index) {
            if (!confirm('ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            salesHistory.splice(index, 1);
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            renderHistory();
        }

        // CSVå‡ºåŠ›ï¼ˆExcelå¯¾å¿œç‰ˆï¼‰
        function exportCSV() {
            if (salesHistory.length === 0) {
                alert('å‡ºåŠ›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const rows = [['æ—¥æ™‚', 'å•†å“å', 'å˜ä¾¡', 'å€‹æ•°', 'å°è¨ˆ', 'æ€§åˆ¥', 'å¹´é½¢å±¤', 'è²©å£²å ´æ‰€']];
            
            salesHistory.forEach(sale => {
                let locationName = 'ã‚¤ãƒ™ãƒ³ãƒˆ';
                if (sale.location && sale.location.startsWith('consignment:')) {
                    locationName = sale.locationName || 'å§”è¨—å…ˆ';
                }
                
                sale.items.forEach(item => {
                    rows.push([
                        new Date(sale.timestamp).toLocaleString('ja-JP'),
                        item.name,
                        item.price,
                        item.quantity,
                        item.price * item.quantity,
                        sale.gender,
                        sale.age,
                        locationName
                    ]);
                });
            });

            const csv = rows.map(row => row.join(',')).join('\n');
            const bom = '\uFEFF';
            const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `å£²ä¸Šå±¥æ­´_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }

        // å±¥æ­´å‰Šé™¤
        function clearHistory() {
            if (!confirm('ã™ã¹ã¦ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) return;
            salesHistory = [];
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            renderHistory();
        }

        // ãŠå¼•è¶Šã—ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰
        function exportBackupData() {
            const backupData = {
                version: '4.0',
                exportDate: new Date().toISOString(),
                products: products,
                locations: locations,
                salesHistory: salesHistory
            };

            const jsonString = JSON.stringify(backupData, null, 2);
            document.getElementById('backup-data-text').value = jsonString;
            document.getElementById('backup-data-display').style.display = 'block';
        }

        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
        function copyBackupData() {
            const textarea = document.getElementById('backup-data-text');
            textarea.select();
            document.execCommand('copy');
            alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚åˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
        }

        // ãŠå¼•è¶Šã—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰
        function importBackupData() {
            const input = document.getElementById('restore-data-input').value.trim();
            
            if (!input) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            if (!confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                return;
            }

            try {
                const backupData = JSON.parse(input);
                
                if (!backupData.salesHistory || !Array.isArray(backupData.salesHistory)) {
                    throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                }

                salesHistory = backupData.salesHistory;
                localStorage.setItem('salesHistory', JSON.stringify(salesHistory));

                if (backupData.products && Array.isArray(backupData.products)) {
                    products = backupData.products;
                    localStorage.setItem('products', JSON.stringify(products));
                }
                
                if (backupData.locations && Array.isArray(backupData.locations)) {
                    locations = backupData.locations;
                    localStorage.setItem('locations', JSON.stringify(locations));
                }

                document.getElementById('restore-data-input').value = '';
                
                renderProducts();
                renderSettingsProducts();
                renderHistory();
                renderInventoryList();
                renderLocationsList();
                updateInventorySelectors();
                
                alert('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚\n\nã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ã‚¢ãƒ—ãƒªèµ·å‹•
        init();

        // PWAå¯¾å¿œ
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,').catch(() => {});
        }
    </script>
</body>
</html>
